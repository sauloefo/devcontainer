#!/bin/bash

set -euo pipefail

[ -z  "$1" ] && { echo "Usage: $0 <project-name>"; exit 1; }

project_name="$1"

[ -d "$project_name" ] && { echo "Can't create $project_name. Directory $(dirname $0)/$project_name already exists"; exit 1; }

docker_image="sauloefo/devcontainer:latest"

mkdir -p "$project_name/.devcontainer"

touch "$project_name/.devcontainer/devcontainer.json"

cat <<EOF > "$project_name/.devcontainer/devcontainer.json"
{
  "name": "$project_name",
  "dockerFile": "Dockerfile",
  "initializeCommand": "docker pull $docker_image",
}
EOF

touch "$project_name/.devcontainer/Dockerfile"
cat <<EOF > "$project_name/.devcontainer/Dockerfile"
FROM $docker_image
EOF

cd "$project_name"

git init

echo "tmp/devcontainer" >> .git/info/exclude

git add .
git commit -m "Initial commit"

echo "Project $project_name created successfully."
